---
ID: "edb45895-c683-41be-8453-f61bd344b945"
Parent: "685709c4-d6d9-46a6-8a9d-df689292daa9"
Template: "dd22f1b3-bd87-4db2-9e7d-f7a496888d43"
Path: /sitecore/system/Modules/PowerShell/Script Library/SPE/Core/Platform/Content Editor/Insert Item/PowerShell Delegated Access
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: office/32x32/keys.png
- ID: "1c76313e-3c8c-4807-a826-135d10c39299"
  Hint: ShowRule
  Type: Rules
  Value: |
    <ruleset>
      <rule
        uid="{B68392BB-77AC-44F8-A17E-4E024DB78FCB}"
        name="Only show for Delegated Access root">
        <conditions>
          <condition
            id="{4F5389E9-79B7-4FE1-A43A-EEA4ECD19C94}"
            uid="2A23E7576A08454088227836A9E4DCA6"
            operatorid="{10537C58-1684-4CAB-B4C0-40C10907CE31}"
            value="{E60089B1-00C3-45FC-A83F-804D2ED4610C}" />
        </conditions>
      </rule>
    </ruleset>
- ID: "b1a94ff0-6897-47c0-9c51-aa6acb80b1f0"
  Hint: Script
  Value: |
    Close-Window
    
    $database = "master"
    
    $settings = @{
        Title = "PowerShell Delegated Access"
        OkButtonName = "Proceed"
        CancelButtonName = "Abort"
        Description = "Configure a new entry for Delegated Access."
        Parameters = @(
            @{ Name = "isEnabled"; Title="Enabled the delegated access"; Value = $false; },
            @{
                Name="itemName"; 
                Title="Item Name"; 
                Tooltip="Enter a new name for the Delegated Access item.";
                Validator={ 
                    if(![Regex]::IsMatch($variable.Value, [Sitecore.Configuration.Settings]::ItemNameValidation)){
                        $variable.Error = "Please enter a valid name."
                    }
                }
            },
            @{ 
                Name = "elevatedRole"; 
                Title="Elevated Role (the current user must be a member)"; 
                Tooltip="Members of this role will experience the elevated privileges."; 
                Editor="role"; 
                Domain="sitecore";
                Validator={
                    if([string]::IsNullOrEmpty($variable.Value[0])) {
                        $variable.Error = "Please select a role."
                    }
                }
            },
            @{ 
                Name = "impersonatedUser";
                Title="Impersonated User (scripts will be executed as this user)";
                Tooltip="Operations performed by the scripts will run using this account.";
                Editor="user";
                Validator={
                    if([string]::IsNullOrEmpty($variable.Value[0])) {
                        $variable.Error = "Please select a user."
                    }
                }
            },
            @{ 
                Name = "scriptItem";
                Title="Script Item (one or more scripts to delegate access)";
                Source="Datasource={A3572733-5062-43E9-A447-54698BC1C637}&IncludeTemplatesForSelection=PowerShell Script,PowerShell Script Library"; 
                editor="treelist";
            }
        )
        Icon = [regex]::Replace($PSScript.Appearance.Icon, "Office", "OfficeWhite", [System.Text.RegularExpressions.RegexOptions]::IgnoreCase)
        ShowHints = $true
        Height = 550
        Width = 650
    }
    
    $result = Read-Variable @settings
    if($result -ne "ok") {
        Exit
    }
    
    
    $item = New-Item -Path $SitecoreContextItem.ProviderPath -Name $itemName -ItemType "{6111D5BE-EC09-4A5C-AD27-7D8005E91216}"
    $item.Enabled = $isEnabled
    $item.ElevatedRole = $elevatedRole | Select-Object -First 1
    $item.ImpersonatedUser = $impersonatedUser | Select-Object -First 1
    $item.ScriptItem = $scriptItem
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20220922T020907Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\Admin
    - ID: "8cdc337e-a112-42fb-bbb4-4143751e123f"
      Hint: __Revision
      Value: "6848b1ca-57a5-40ed-a4d9-71e4055611c1"
